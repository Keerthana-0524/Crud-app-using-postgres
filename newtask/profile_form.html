<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if form.instance.id %}Update Profile{% else %}Create Profile{% endif %}</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        /* Embedded CSS styles */
        /* Customize as needed */
        body {
            background-color: #f8f9fa;
            padding-top: 20px;
        }
        .form-container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .btn-custom {
            margin-right: 10px;
            background-color: #ffb3ba; /* pastel red */
            border-color: #ffb3ba;
            color: #fff;
        }
        .btn-custom:hover {
            background-color: #ffdfba; /* light pastel orange */
            border-color: #ffdfba;
            color: #fff;
        }
        .btn-secondary {
            background-color: #bae1ff; /* pastel blue */
            border-color: #bae1ff;
            color: #000;
        }
        .btn-secondary:hover {
            background-color: #baffc9; /* light pastel green */
            border-color: #baffc9;
            color: #000;
        }
        .form-control {
            width: 100%; /* Ensure all input fields have 100% width */
            border-color: #ccc; /* light gray */
        }
        .error-message {
            color: #dc3545; /* Bootstrap danger color */
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <header class="navbar navbar-expand-lg navbar-light bg-light justify-content-center">
        <div>
            <a class="navbar-brand" href="#">User Profile Home</a>
        </div>
        <div class="navbar-nav">
            <a class="nav-item nav-link" href="{% url 'profile_list' %}">User Profiles</a>
            <a class="nav-item nav-link" href="{% url 'profile_create' %}">Create Profile</a>
        </div>
    </header>

    <div class="container">
        <div class="form-container">
            <h1 class="my-4">{{ form.instance.id|yesno:"Update Profile,Create Profile" }}</h1>
            <form method="post" id="profileForm" action="{% if form.instance.id %}{% url 'profile_update' form.instance.id %}{% else %}{% url 'profile_create' %}{% endif %}">
                {% csrf_token %}
                <div class="form-group">
                    <label for="id_first_name">First Name</label>
                    <input type="text" class="form-control" id="id_first_name" name="first_name" value="{{ form.first_name.value|default_if_none:'' }}" placeholder="">
                </div>
                <div class="form-group">
                    <label for="id_last_name">Last Name</label>
                    <input type="text" class="form-control" id="id_last_name" name="last_name" value="{{ form.last_name.value|default_if_none:'' }}" placeholder="">
                </div>
                <div class="form-group">
                    <label for="id_email">Email</label>
                    <input type="email" class="form-control" id="id_email" name="email" value="{{ form.email.value|default_if_none:'' }}" placeholder="">
                </div>
                <div class="form-group">
                    <label for="id_password">Password</label>
                    <input type="password" class="form-control" id="id_password" name="password" placeholder="">
                    <small id="passwordHelp" class="form-text text-muted">
                        Password must be at least 8 characters long and contain at least one number and one special character.
                    </small>
                    <span id="passwordError" class="error-message"></span>
                </div>
                <div class="form-group">
                    <label for="id_date_of_birth">Date of Birth</label>
                    <input type="text" class="form-control" id="id_date_of_birth" name="date_of_birth" value="{{ form.date_of_birth.value|default_if_none:'' }}" placeholder="">
                </div>
                <div class="form-group">
                    <label for="id_age">Age</label>
                    <input type="text" class="form-control" id="id_age" name="age" readonly value="" placeholder="">
                </div>
                
                <button type="submit" class="btn btn-custom">Save</button>
                <a href="{% url 'profile_list' %}" class="btn btn-secondary">Cancel</a>
            </form>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        // Initialize Flatpickr for date picker
        document.addEventListener('DOMContentLoaded', function() {
            flatpickr("#id_date_of_birth", {
                dateFormat: "Y-m-d",
                maxDate: "today",
                onChange: function(selectedDates, dateStr, instance) {
                    if (dateStr !== "") {
                        var dob = new Date(dateStr);
                        var ageDifMs = Date.now() - dob.getTime();
                        var ageDate = new Date(ageDifMs);
                        var calculatedAge = Math.abs(ageDate.getUTCFullYear() - 1970);
                        document.getElementById("id_age").value = calculatedAge;
                    }
                }
            });

            // Client-side password validation
            document.getElementById("profileForm").addEventListener("submit", function(event) {
                var passwordField = document.getElementById("id_password");
                var password = passwordField.value.trim();
                var passwordError = document.getElementById("passwordError");
                var validPassword = true;

                // Reset previous error message
                passwordError.textContent = "";

                // Validate password criteria
                if (password.length < 8) {
                    passwordError.textContent = "Password must be at least 8 characters long.";
                    validPassword = false;
                } else if (!/\d/.test(password)) {
                    passwordError.textContent = "Password must contain at least one digit.";
                    validPassword = false;
                } else if (!/[!@#$%^&*(),.?":{}|<>]/.test(password)) {
                    passwordError.textContent = "Password must contain at least one special character.";
                    validPassword = false;
                }

                // Prevent form submission if password is invalid
                if (!validPassword) {
                    event.preventDefault();
                    passwordField.focus();
                }
            });
        });
    </script>
</body>
</html>
